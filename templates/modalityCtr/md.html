[[extend "baseof.html"]]

[[ block page_head]]
<link href="js/bootstrap-table_1.22/bootstrap-table.min.css" rel="stylesheet">
[[ include 'modalityCtr/styles/md-responsive.html' ]]
[[ include 'modalityCtr/styles/md-billing.html' ]]
[[ end ]]

[[ block left_nav ]]
[[ end]]

[[ include 'partials/patient-bar.html' ]]

<div class="container-fluid mb-3"> <!-- controller title-->
    <div class="row big-title bg-neutral">
        <div class="col">
            <h1><a role="button" data-bs-toggle="collapse" href=".md">Medical examination</a></h1>
        </div>
    </div>
</div>

<div id="hx-container" class="container-fluid mb-3"> <!-- Hx container-->
    <div class="row mb-3 big-title bg-primary">
        <div class="col">
            <h2><a role="button" data-bs-toggle="collapse" href=".history">Past history</a></h2>
        </div>
    </div>
    <div class="row history">
        <div class="col">
            <h3 class="big-title bg-secondary"><a role="button" data-bs-toggle="collapse" href=".gHx">General
                    history</a></h3>
            <div class="row gHx">
                <div class="col">
                    <div class="row mb-3"> <!-- row medications -->
                        <div class="col">
                            <div class="row">
                                <div class="col">
                                    <h4 class="title-right">Medications</h4>
                                    <div>
                                        <button type="button" id="btnNewMx" class="btn btn-dark btn-sm"
                                            data-bs-toggle="modal" data-status-flag="historyMx" data-mx-flag="historyMx"
                                            data-bs-target="#mxModal">
                                            Add medication<i class="mx-2 fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3 bg-right">
                                <div class="col">
                                    <table id="mx_tbl" data-side-pagination="server" data-pagination="true"
                                        data-page-size="10" data-search="false" data-query-params="queryParams"
                                        data-response-handler="responseHandler_mx"
                                        data-detail-formatter="detailFormatter_mx" data-detail-view="true"
                                        data-detail-view-icon="true">
                                        <thead>
                                            <tr>
                                                <th data-field="onset" data-sortable="true">Onset</th>
                                                <th data-field="ended" data-sortable="false">Ended</th>
                                                <th data-field="medication" data-sortable="true">Medication</th>
                                                <th data-field="delivery" data-sortable="false">Delivery</th>
                                                <th data-field="frequency_h" data-sortable="false">Frequency</th>
                                                <th data-field="note" data-sortable="false">Note</th>
                                                <th data-field="prescribed" data-sortable="false">Prescribed</th>
                                                <th data-field="operate" data-formatter="operateFormatter_mx"
                                                    data-events="operateEvents_mx">Action
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="row mb-3">
                        <div class="row mb-3">
                            <div class="col">
                                <h4 class="big-title bg-warning">Allergy</h4>
                            </div>
                            <div>
                                <button type="button" id="btnNewAx" class="btn btn-dark btn-sm" data-bs-toggle="modal"
                                    data-bs-target="#axModal">
                                    Add allergy<i class="mx-2 fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="row mb-3 bg-neutral">
                            <div class="col">
                                <table id="ax_tbl" data-side-pagination="server" data-pagination="true"
                                    data-page-size="10" data-search="false" data-query-params="queryParams"
                                    data-row-style="rowStyle_ax" data-response-handler="responseHandler_ax"
                                    data-detail-formatter="detailFormatter_ax" data-detail-view="true"
                                    data-detail-view-icon="true">
                                    <thead>
                                        <tr>
                                            <th data-field="onset" data-sortable="true">Onset</th>
                                            <th data-field="ended" data-sortable="false">Ended</th>
                                            <th data-field="typ" data-sortable="true">Type</th>
                                            <th data-field="agent" data-sortable="true">Agent</th>
                                            <th data-field="operate" data-formatter="operateFormatter_ax"
                                                data-events="operateEvents_ax">Action</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- end div row medications allergy -->
            <div class="row gHx">
                <div class="col">
                    <div class="row mb-3"> <!-- row mHx -->
                        <div class="col">
                            <h4 class="title-right">Medical Hx</h4>
                            <div>
                                <button type="button" id="btnNewmHx" class="btn btn-dark btn-sm" data-bs-toggle="modal"
                                    data-bs-target="#mHxModal" data-category-flag="medical">Add past medical history<i
                                        class="mx-2 fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="row mt-3 bg-right"> <!-- mHx_tbl-->
                            <div class="col">
                                <table id="mHx_tbl" data-side-pagination="server" data-pagination="true"
                                    data-page-size="10" data-search="false" data-query-params="queryParams"
                                    data-response-handler="responseHandler_msHx"
                                    data-detail-formatter="detailFormatter_msHx" data-detail-view="true"
                                    data-detail-view-icon="true">
                                    <thead>
                                        <tr>
                                            <th data-field="onset" data-sortable="true">Onset</th>
                                            <th data-field="ended" data-sortable="false">Ended</th>
                                            <th data-field="title" data-sortable="true">Title</th>
                                            <th data-field="icd10" data-sortable="true">ICD-10</th>
                                            <th data-field="site" data-sortable="true">Site</th>
                                            <th data-field="note" data-sortable="true">Note</th>
                                            <th data-field="operate" data-formatter="operateFormatter_msHx"
                                                data-events="operateEvents_msHx">Action</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div> <!-- end row mHx_tbl-->
                    </div>
                </div>
                <div class="col">
                    <div class="row mb-3">
                        <div class="row mb-3">
                            <h4 class="title-left">Surgical Hx</h4>
                            <div>
                                <button type="button" id="btnNewsHx" class="btn btn-dark btn-sm" data-bs-toggle="modal"
                                    data-bs-target="#mHxModal" data-category-flag="surgical">Add past surgical history<i
                                        class="mx-2 fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="row mb-3 bg-left">
                            <div class="col">
                                <table id="sHx_tbl" data-side-pagination="server" data-pagination="true"
                                    data-page-size="10" data-search="false" data-query-params="queryParams"
                                    data-response-handler="responseHandler_msHx"
                                    data-detail-formatter="detailFormatter_msHx" data-detail-view="true"
                                    data-detail-view-icon="true">
                                    <thead>
                                        <tr>
                                            <th data-field="onset" data-sortable="true">Onset</th>
                                            <th data-field="ended" data-sortable="false">Ended</th>
                                            <th data-field="title" data-sortable="true">Title</th>
                                            <th data-field="icd10" data-sortable="true">ICD-10</th>
                                            <th data-field="site" data-sortable="true">Site</th>
                                            <th data-field="note" data-sortable="true">Note</th>
                                            <th data-field="operate" data-formatter="operateFormatter_msHx"
                                                data-events="operateEvents_msHx">Action</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- end div row mHx sHx -->
        </div>
    </div>
    <div class="row history">
        <h3 class="big-title bg-info"><a role="button" data-bs-toggle="collapse" href=".oHx">Ocular history</a></h3>
        [[ if userMembership == 'Doctor':]]
        <div class="row mb-3 bg-neutral"> <!-- row oHx-->
            <div class="col oHx">
                <table id="oHx_tbl" data-side-pagination="server" data-pagination="true" data-page-size="10"
                    data-search="false" data-query-params="queryParams" data-response-handler="responseHandler_msHx"
                    data-detail-formatter="detailFormatter_msHx" data-detail-view="true" data-detail-view-icon="true">
                    <thead>
                        <tr>
                            <th data-field="onset" data-sortable="true">Onset</th>
                            <th data-field="ended" data-sortable="false">Ended</th>
                            <th data-field="title" data-sortable="true">Title</th>
                            <th data-field="icd10" data-sortable="true">ICD-10</th>
                            <th data-field="site" data-sortable="true">Side</th>
                            <th data-field="note" data-sortable="true">Note</th>
                            <th data-field="operate" data-formatter="operateFormatter_msHx"
                                data-events="operateEvents_msHx">Action</th>
                        </tr>
                    </thead>
                </table>
            </div> <!-- end oHx col-->
        </div> <!-- end oHx row-->
        [[ pass ]]
        <div class="row mb-3 oHx"> <!-- row wlHx-->
            <div class="col">
                <h4><span class=""><i class="fas fa-list me-2"></i>Worklist<span></h4>
                <div id="toolbar-wl">
                </div>
                <table id="table-wl" data-toolbar-align="right" data-toolbar="#toolbar-wl" data-id-field="id"
                    data-side-pagination="server" data-show-refresh="true" data-pagination="true" data-page-size="5"
                    data-show-columns="true" data-search="true" data-search-accent-neutralise="true"
                    data-visible-search="false" data-query-params="queryParams_wl"
                    data-response-handler="responseHandler_wl" data-row-style="rowStyle_wl" data-detail-view="true"
                    data-detail-view-icon="true" data-detail-formatter="detailFormatter_wl"
                    data-detail-view-by-click="false">
                    <thead class="thead-dark">
                        <th data-field="id" data-sortable="true">ID</th>
                        <th data-field="sending_facility" data-sortable="true">Sending facility:</th>
                        <th data-field="receiving_facility" data-title="Receiving facility" data-sortable="true">
                            Receving facility:</th>
                        <th data-field="procedure" data-searchable="true" data-sortable="true">Procedure:</th>
                        <th data-field="provider" data-searchable="true" data-sortable="true">Provider:</th>
                        <th data-field="senior" data-searchable="true" data-sortable="true">Senior:</th>
                        <th data-field="modality" data-searchable="true" data-sortable="true">Modality:</th>
                        <th data-field="laterality" data-sortable="false" data-searchable="false">Laterality:</th>
                        <th data-field="requested_time" data-sortable="true" data-searchable="true">Timeslot:</th>
                        <th data-field="status_flag" data-searchable="true" data-sortable="true">Status:</th>
                        <th data-field="counter" data-searchable="true" data-sortable="false"
                            data-formatter="counterFormatter_wl">Counter:</th>
                        <th data-field="warning" data-searchable="true" data-sortable="false">Warning:</th>
                        <th data-field="operate" data-formatter="operateFormatter_wl" data-events="operateEvents_wl">
                            Action</th>
                    </thead>
                </table>
            </div>
        </div> <!-- end row wlHx-->
        <div class="row mb-3 oHx"> <!-- row tono-->
            <div class="col"> <!-- right column-->
                <div class="row">
                    <div class="col">
                        <h4 class="title-right">Right tono</h4>
                    </div>
                </div>
                <div class="row bg-right">
                    <div class="col"> <!-- right table tono-->
                        <table id="tonoRight_tbl" data-side-pagination="server" data-pagination="true"
                            data-page-size="10" data-search="false" data-query-params="queryParams"
                            data-response-handler="responseHandler_tono" data-detail-view="true"
                            data-detail-view-icon="true" data-detail-formatter="detailFormatter_tono"
                            data-detail-view-by-click="false">
                            <thead>
                                <tr>
                                    <th data-field="timestamp" data-sortable="true">Timestamp</th>
                                    <th data-field="tonometry" data-sortable="true">Tono</th>
                                    <th data-field="techno" data-sortable="true">Method</th>
                                    <th data-field="pachymetry" data-sortable="true">Pachy</th>
                                    <th data-field="operate" data-formatter="operateFormatter_tono"
                                        data-events="operateEvents_tono">Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col"> <!-- left column -->
                <div class="row">
                    <div class="col">
                        <h4 class="title-left">Left tono</h4>
                    </div>
                </div>
                <div class="row bg-left">
                    <div class="col"> <!-- left table tono-->
                        <table id="tonoLeft_tbl" data-side-pagination="server" data-pagination="true"
                            data-page-size="10" data-query-params="queryParams"
                            data-response-handler="responseHandler_tono" data-detail-view="true"
                            data-detail-view-icon="true" data-detail-formatter="detailFormatter_tono"
                            data-detail-view-by-click="false">
                            <thead>
                                <tr>
                                    <th data-field="timestamp" data-sortable="true">Timestamp</th>
                                    <th data-field="tonometry" data-sortable="true">Tono</th>
                                    <th data-field="techno" data-sortable="true">Method</th>
                                    <th data-field="pachymetry" data-sortable="true">Pachy</th>
                                    <th data-field="operate" data-formatter="operateFormatter_tono"
                                        data-events="operateEvents_tono">Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div> <!-- end row tono-->
        <div class="row mb-3 oHx"> <!-- row rx-->
            <div class="col"> <!-- right column-->
                <div class="row">
                    <div class="col">
                        <h4 class="title-right">Right rx</h4>
                    </div>
                </div>
                <div class="row bg-right">
                    <div class="col"> <!-- right table rx-->
                        <table id="rxRight_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                            data-search="false" data-query-params="queryParams"
                            data-response-handler="responseHandler_rx" data-detail-formatter="detailFormatter_rx"
                            data-row-style="rowStyle_type" data-detail-view="true" data-detail-view-icon="true">
                            <thead>
                                <tr>
                                    <th data-field="timestamp" data-sortable="true">Timestamp</th>
                                    <th data-field="rx_origin" data-sortable="true">Type</th>
                                    <th data-field="note" data-sortable="false">Note</th>
                                    <th data-field="va_far" data-sortable="true">VA far</th>
                                    <th data-field="rx_far" data-cell-style="cellStyle_formula" data-sortable="false">Rx
                                        far</th>
                                    <th data-field="se_far" data-cell-style="cellStyle_formula" data-sortable="false">SE
                                    </th>
                                    <th data-field="add" data-cell-style="cellStyle_add" data-sortable="false">Add</th>
                                    <th data-field="va_close" data-sortable="true">VA close</th>
                                    <th data-field="operate" data-formatter="operateFormatter_rx"
                                        data-events="operateEvents_rx">Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <div class="row bg-right">
                    <div class="col"> <!-- right table km-->
                        <table id="kmRight_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                            data-search="false" data-query-params="queryParams"
                            data-response-handler="responseHandler_km" data-detail-formatter="detailFormatter_km"
                            data-row-style="rowStyle_km" data-detail-view="true" data-detail-view-icon="true">
                            <thead>
                                <tr>
                                    <th data-field="timestamp" data-sortable="true">Timestamp</th>
                                    <th data-field="formulak1" data-sortable="false" data-cell-style="cellStyle_k1">K1
                                    </th>
                                    <th data-field="formulak2" data-sortable="false" data-cell-style="cellStyle_k2">K2
                                    </th>
                                    <th data-field="operate" data-formatter="operateFormatter_km"
                                        data-events="operateEvents_km">Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col"> <!-- left column -->
                <div class="row">
                    <div class="col">
                        <h4 class="title-left">Left rx</h4>
                    </div>
                </div>
                <div class="row bg-left">
                    <div class="col"> <!-- left table rx-->
                        <table id="rxLeft_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                            data-search="false" data-query-params="queryParams"
                            data-response-handler="responseHandler_rx" data-detail-formatter="detailFormatter_rx"
                            data-row-style="rowStyle_type" data-detail-view="true" data-detail-view-icon="true">
                            <thead>
                                <tr>
                                    <th data-field="timestamp" data-sortable="true">Timestamp</th>
                                    <th data-field="rx_origin" data-sortable="true">Type</th>
                                    <th data-field="note" data-sortable="false">Note</th>
                                    <th data-field="va_far" data-sortable="true">VA far</th>
                                    <th data-field="rx_far" data-cell-style="cellStyle_formula" data-sortable="false">Rx
                                        far</th>
                                    <th data-field="se_far" data-cell-style="cellStyle_formula" data-sortable="false">SE
                                    </th>
                                    <th data-field="add" data-cell-style="cellStyle_add" data-sortable="false">Add</th>
                                    <th data-field="va_close" data-sortable="true">VA close</th>
                                    <th data-field="operate" data-formatter="operateFormatter_rx"
                                        data-events="operateEvents_rx">Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <div class="row bg-left">
                    <div class="col"> <!-- left table km-->
                        <table id="kmLeft_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                            data-search="false" data-query-params="queryParams"
                            data-response-handler="responseHandler_km" data-detail-formatter="detailFormatter_km"
                            data-row-style="rowStyle_km" data-detail-view="true" data-detail-view-icon="true">
                            <thead>
                                <tr>
                                    <th data-field="timestamp" data-sortable="true">Timestamp</th>
                                    <th data-field="formulak1" data-sortable="false" data-cell-style="cellStyle_k1">K1
                                    </th>
                                    <th data-field="formulak2" data-sortable="false" data-cell-style="cellStyle_k2">K2
                                    </th>
                                    <th data-field="operate" data-formatter="operateFormatter_km"
                                        data-events="operateEvents_km">Action</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div> <!-- end row rx-->
    </div> <!-- end row oHx -->
</div> <!-- end Hx container-->
[[ include 'modalityCtr/sections/examination/present-history.html' ]]
<div id="cx-container" class="container-fluid mb-3"> <!-- container clinical exam -->
    <div class="row mb-3 big-title bg-primary">
        <div>
            <h2><a role="button" data-bs-toggle="collapse" href=".clinical">Clinical exam</a></h2>
        </div>
    </div>
    [[ if userMembership == 'Doctor':]]
    <div class="row mb-3 clinical">
        <div class="col"> <!-- 1 col -->
            <div class="row mb-3"> <!-- 1 row -->
                <div class="col"> <!-- right eye col -->
                    <div class="row"> <!-- row title right eye col -->
                        <div class="col">
                            <h3 class="title-right">Right eye</h3>
                        </div>
                    </div> <!-- end row title right eye col -->
                    <div class="row bg-right"> <!-- anterior and posterior right forms row -->
                        <div class="col py-3"> <!-- antRight col -->
                            <h5 class="text-center">Anterior exam</h5>
                            <form id="antRightForm" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antRightantChamber" class="form-control"
                                                    aria-label="anterior chamber exam" name="ant_chamb"
                                                    value="[[ = XML(antRight['ant_chamb']) ]]" autocomplete="on" />
                                                <label for="antRightantChamber">Anterior segment exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antRightouter" class="form-control"
                                                    aria-label="Outer findings" name="outer"
                                                    value="[[ = XML(antRight['outer']) ]]" autocomplete="on" />
                                                <label for="antRightouter">Outer findings (eyelids,
                                                    conjunctiva...)</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antRightCornea" class="form-control"
                                                    aria-label="cornea exam" name="cornea"
                                                    value="[[ = XML(antRight['cornea']) ]]" autocomplete="on" />
                                                <label for="antRightCornea">Cornea exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antRightIris" class="form-control"
                                                    aria-label="iris exam" name="iris"
                                                    value="[[ = XML(antRight['iris']) ]]" autocomplete="on" />
                                                <label for="antRightIris">Iris exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antRightLens" class="form-control"
                                                    aria-label="lens exam" name="lens"
                                                    value="[[ = XML(antRight['lens']) ]]" autocomplete="on" />
                                                <label for="antRightLens">Lens exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antRightOther" class="form-control"
                                                    aria-label="lens exam" name="other"
                                                    value="[[ = XML(antRight['other']) ]]" autocomplete="on" />
                                                <label for="antRightOther">Other findings</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="container-fluid">
                                    <input id="lateralityantRight" type="text" class="visually-hidden" name="laterality"
                                        value="right" />
                                    <input id="idantRight" type="text" class="visually-hidden" name="id"
                                        value="[[ = XML(antRight['id']) ]]" />
                                    <input id="idPatientantRight" type="text" class="visually-hidden"
                                        name="id_auth_user" />
                                    <input id="idWlantRight" type="text" class="visually-hidden" name="id_worklist" />
                                    <button id="antRightFormSubmit" type="submit" class="btn btn-secondary">Update<i
                                            class="mx-2 fas fa-plus"></i></button>
                                </div>
                            </form>
                        </div> <!-- antRight end col -->
                        <div class="col pt-3"> <!-- postRight col -->
                            <h5 class="text-center">Posterior exam</h5>
                            <form id="postRightForm" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postRightpost_chamb" class="form-control"
                                                    aria-label="posterior segment exam" name="post_chamb"
                                                    value="[[ = XML(postRight['post_chamb']) ]]" autocomplete="on" />
                                                <label for="postRightpost_chamb">Posterior segment exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postRightVitreous" class="form-control"
                                                    aria-label="vitreous exam" name="vitreous"
                                                    value="[[ = XML(postRight['vitreous']) ]]" autocomplete="on" />
                                                <label for="postRightVitreous">Vitreous exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postRightRetina" class="form-control"
                                                    aria-label="retina exam" name="retina"
                                                    value="[[ = XML(postRight['retina']) ]]" autocomplete="on" />
                                                <label for="postRightRetina">Retina exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postRightMacula" class="form-control"
                                                    aria-label="macula exam" name="macula"
                                                    value="[[ = XML(postRight['macula']) ]]" autocomplete="on" />
                                                <label for="postRightMacula">Macula exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postRightPapil" class="form-control"
                                                    aria-label="papil exam" name="papil"
                                                    value="[[ = XML(postRight['papil']) ]]" autocomplete="on" />
                                                <label for="postRightPapil">Papil exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postRightOther" class="form-control"
                                                    aria-label="lens exam" name="other"
                                                    value="[[ = XML(postRight['other']) ]]" autocomplete="on" />
                                                <label for="postRightOther">Other findings</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="container-fluid">
                                    <input id="lateralitypostRight" type="text" class="visually-hidden"
                                        name="laterality" value="right" />
                                    <input id="idpostRight" type="text" class="visually-hidden" name="id"
                                        value="[[ = XML(postRight['id']) ]]" />
                                    <input id="idPatientpostRight" type="text" class="visually-hidden"
                                        name="id_auth_user" />
                                    <input id="idWlpostRight" type="text" class="visually-hidden" name="id_worklist" />
                                    <button id="postRightFormSubmit" type="submit" class="btn btn-secondary">Update<i
                                            class="mx-2 fas fa-plus"></i></button>
                                </div>
                            </form>
                        </div>
                    </div> <!-- end anterior and posterior right forms row -->
                </div> <!-- end right eye col -->
                <div class="col"> <!-- left eye col -->
                    <div class="row"> <!-- row title left eye col -->
                        <div class="col">
                            <h3 class="title-left">Left eye</h3>
                        </div>
                    </div> <!-- end row title left eye col -->
                    <div class="row bg-left"> <!-- anterior and posterior left forms row -->
                        <div class="col py-3"> <!-- antLeft col -->
                            <h5 class="text-center">Anterior exam</h5>
                            <form id="antLeftForm" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antLeftantChamber" class="form-control"
                                                    aria-label="anterior chamber exam" name="ant_chamb"
                                                    value="[[ = XML(antLeft['ant_chamb']) ]]" autocomplete="on" />
                                                <label for="antLeftantChamber">Anterior segment exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antLeftouter" class="form-control"
                                                    aria-label="Outer findings" name="outer"
                                                    value="[[ = XML(antLeft['outer']) ]]" autocomplete="on" />
                                                <label for="antLeftouter">Outer findings (eyelids,
                                                    conjunctiva...)</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antLeftCornea" class="form-control"
                                                    aria-label="cornea exam" name="cornea"
                                                    value="[[ = XML(antLeft['cornea']) ]]" autocomplete="on" />
                                                <label for="antLeftCornea">Cornea exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antLeftIris" class="form-control"
                                                    aria-label="iris exam" name="iris"
                                                    value="[[ = XML(antLeft['iris']) ]]" autocomplete="on" />
                                                <label for="antLeftIris">Iris exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antLeftLens" class="form-control"
                                                    aria-label="lens exam" name="lens"
                                                    value="[[ = XML(antLeft['lens']) ]]" autocomplete="on" />
                                                <label for="antLeftLens">Lens exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="antLeftOther" class="form-control"
                                                    aria-label="lens exam" name="other"
                                                    value="[[ = XML(antLeft['other']) ]]" autocomplete="on" />
                                                <label for="antLeftOther">Other findings</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="container-fluid">
                                    <input id="lateralityantLeft" type="text" class="visually-hidden" name="laterality"
                                        value="left" />
                                    <input id="idantLeft" type="text" class="visually-hidden" name="id"
                                        value="[[ = XML(antLeft['id']) ]]" />
                                    <input id="idPatientantLeft" type="text" class="visually-hidden"
                                        name="id_auth_user" />
                                    <input id="idWlantLeft" type="text" class="visually-hidden" name="id_worklist" />
                                    <button id="antLeftFormSubmit" type="submit" class="btn btn-secondary">Update<i
                                            class="mx-2 fas fa-plus"></i></button>
                                </div>
                            </form>
                        </div> <!-- end antLeft col -->
                        <div class="col py-3"> <!-- postLeft form col -->
                            <h5 class="text-center">Posterior exam</h5>
                            <form id="postLeftForm" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postLeftpost_chamb" class="form-control"
                                                    aria-label="post segment exam" name="post_chamb"
                                                    value="[[ = XML(postLeft['post_chamb']) ]]" autocomplete="on" />
                                                <label for="postLeftpost_chamb">Posterior segment exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postLeftVitreous" class="form-control"
                                                    aria-label="vitreous exam" name="vitreous"
                                                    value="[[ = XML(postLeft['vitreous']) ]]" autocomplete="on" />
                                                <label for="postLeftVitreous">Vitreous exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postLeftRetina" class="form-control"
                                                    aria-label="retina exam" name="retina"
                                                    value="[[ = XML(postLeft['retina']) ]]" autocomplete="on" />
                                                <label for="postLeftRetina">Retina exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postLeftMacula" class="form-control"
                                                    aria-label="macula exam" name="macula"
                                                    value="[[ = XML(postLeft['macula']) ]]" autocomplete="on" />
                                                <label for="postLeftMacula">Macula exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postLeftPapil" class="form-control"
                                                    aria-label="papil exam" name="papil"
                                                    value="[[ = XML(postLeft['papil']) ]]" autocomplete="on" />
                                                <label for="postLeftPapil">Papil exam</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <div class="form-floating">
                                                <input type="text" id="postLeftOther" class="form-control"
                                                    aria-label="lens exam" name="other"
                                                    value="[[ = XML(postLeft['other']) ]]" autocomplete="on" />
                                                <label for="postLeftOther">Other findings</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="container-fluid">
                                    <input id="lateralitypostLeft" type="text" class="visually-hidden" name="laterality"
                                        value="left" />
                                    <input id="idpostLeft" type="text" class="visually-hidden" name="id"
                                        value="[[ = XML(postLeft['id']) ]]" />
                                    <input id="idPatientpostLeft" type="text" class="visually-hidden"
                                        name="id_auth_user" />
                                    <input id="idWlpostLeft" type="text" class="visually-hidden" name="id_worklist" />
                                    <button id="postLeftFormSubmit" type="submit" class="btn btn-secondary">Update<i
                                            class="mx-2 fas fa-plus"></i></button>
                                </div>
                            </form>
                        </div> <!-- end postLeft form col -->
                    </div> <!-- end anterior and posterior left forms row -->
                </div> <!-- end left eye col -->
            </div> <!-- end 1 row -->
        </div> <!-- end 1 col -->
    </div>
    [[ pass ]]
    <div class="row mb-3 clinical">
        <div class="col">
            <div class="row">
                <div class="col">
                    [[ include 'modalityCtr/sections/examination/miscellaneous.html' ]]
                </div>
            </div>
        </div>
    </div>
</div> <!-- end clinical exam container-->
<div id="cc-container" class="container-fluid mb-3"> <!-- container conclusions -->
    <div class="row mb-3">
        <div class="col">
            <div class="row">
                <div class="col big-title bg-primary">
                    <h2><a role="button" data-bs-toggle="collapse" href=".dx">Conclusions</a></h2>
                </div>
            </div>
            <div class="row bg-right py-3 dx">
                <div class="col">
                    <form id="ccxForm" enctype="multipart/form-data" method="POST">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col">
                                    <div class="input-group">
                                        <button id="ccxFormSubmit" type="submit" class="btn btn-secondary">Update<i
                                                class="mx-2 fas fa-plus"></i></button>
                                        <textarea class="form-control" aria-label="With textarea"
                                            name="description">[[ = XML(ccx['description']) ]]</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input id="lateralityccx" type="text" class="visually-hidden" name="laterality" value="na" />
                        <input id="idccx" type="text" class="visually-hidden" name="id"
                            value="[[ = XML(ccx['id']) ]]" />
                        <input id="idPatientccx" type="text" class="visually-hidden" name="id_auth_user"
                            value="[[=patientId]]" />
                        <input id="idWlccx" type="text" class="visually-hidden" name="id_worklist" value="[[=wlId]]" />
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-3 dx">
        <div class="col">
            <div class="row">
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <h3 class="title-right">Right eye</h3>
                        </div>
                    </div>
                    <div class="row bg-right py-3">
                        <div class="col">
                            <form id="ccxRForm" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col">
                                            <div class="input-group">
                                                <button id="ccxRFormSubmit" type="submit"
                                                    class="btn btn-secondary">Update<i
                                                        class="mx-2 fas fa-plus"></i></button>
                                                <textarea class="form-control" aria-label="With textarea"
                                                    name="description">[[ = XML(ccxR['description']) ]]</textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input id="lateralityccxR" type="text" class="visually-hidden" name="laterality"
                                    value="right" />
                                <input id="idccxR" type="text" class="visually-hidden" name="id"
                                    value="[[ = XML(ccxR['id']) ]]" />
                                <input id="idPatientccxR" type="text" class="visually-hidden" name="id_auth_user"
                                    value="[[=patientId]]" />
                                <input id="idWlccxR" type="text" class="visually-hidden" name="id_worklist"
                                    value="[[=wlId]]" />
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <h3 class="title-left">Left eye</h3>
                        </div>
                    </div>
                    <div class="row bg-left py-3">
                        <div class="col">
                            <form id="ccxLForm" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col">
                                            <div class="input-group">
                                                <button id="ccxLFormSubmit" type="submit"
                                                    class="btn btn-secondary">Update<i
                                                        class="mx-2 fas fa-plus"></i></button>
                                                <textarea class="form-control" aria-label="With textarea"
                                                    name="description">[[ = XML(ccxL['description']) ]]</textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input id="lateralityccxL" type="text" class="visually-hidden" name="laterality"
                                    value="left" />
                                <input id="idccxL" type="text" class="visually-hidden" name="id"
                                    value="[[ = XML(ccxR['id']) ]]" />
                                <input id="idPatientccxL" type="text" class="visually-hidden" name="id_auth_user"
                                    value="[[=patientId]]" />
                                <input id="idWlccxL" type="text" class="visually-hidden" name="id_worklist"
                                    value="[[=wlId]]" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-3 dx">
        <div class="col">
            <div class="row">
                <div class="col">
                    <h3 class="title-right">Coding</h3>
                </div>
            </div>
            <div class="row bg-right">
                <div class="col ">
                    <button type="button" id="btnNewCoding" class="btn btn-dark btn-sm" data-bs-toggle="modal"
                        data-bs-target="#mHxModal" data-category-flag="medical" data-mhx-flag="code">Add code<i
                            class="mx-2 fas fa-plus"></i></button>
                    <table id="coding_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                        data-search="false" data-query-params="queryParams" data-response-handler="responseHandler_msHx"
                        data-detail-formatter="detailFormatter_msHx" data-detail-view="true"
                        data-detail-view-icon="true">
                        <thead>
                            <tr>
                                <th data-field="onset" data-sortable="true">Onset</th>
                                <th data-field="ended" data-sortable="false">Ended</th>
                                <th data-field="title" data-sortable="true">Title</th>
                                <th data-field="icd10" data-sortable="true">ICD-10</th>
                                <th data-field="site" data-sortable="true">Side</th>
                                <th data-field="note" data-sortable="true">Note</th>
                                <th data-field="operate" data-formatter="operateFormatter_msHx"
                                    data-events="operateEvents_msHx">Action</th>
                            </tr>
                        </thead>
                    </table>
                </div> <!-- end coding col-->
            </div>
        </div>
    </div>
</div>
<div id="x-container" class="container-fluid mb-3"> <!-- container actions -->
    <div class="row mb-3 big-title bg-warning">
        <div class="col">
            <h2><a role="button" data-bs-toggle="collapse" href=".actions">Actions</a></h2>
        </div>
    </div>
    <div class="row mb-3 actions">
        [[ if userMembership == 'Doctor':]]
        <div class="col">
            <div class="row">
                <div class="col">
                    <div class="col">
                        <h3 class="title-right">Medical Rx</h3>
                    </div>
                </div>
            </div>
            <div class="row bg-right">
                <div class="col">
                    <button type="button" id="btnNewMxWl" class="btn btn-dark btn-sm " data-bs-toggle="modal"
                        data-bs-target="#mxModal" data-mx-flag="mxWl">Add medic<i class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnMxRx" class="btn btn-warning btn-sm float-end">Prescribe medications<i
                            class="mx-2 fas fa-prescription"></i></button>
                    <table id="mxWl_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                        data-search="false" data-query-params="queryParams" data-response-handler="responseHandler_mx"
                        data-detail-formatter="detailFormatter_mx" data-detail-view="true" data-detail-view-icon="true">
                        <thead>
                            <tr>
                                <th data-field="onset" data-sortable="true">Onset</th>
                                <th data-field="ended" data-sortable="false">Ended</th>
                                <th data-field="medication" data-sortable="true">Medication</th>
                                <th data-field="delivery" data-sortable="false">Delivery</th>
                                <th data-field="frequency_h" data-sortable="false">Frequency</th>
                                <th data-field="note" data-sortable="false">Note</th>
                                <th data-field="prescribed" data-sortable="false">Prescribed</th>
                                <th data-field="operate" data-formatter="operateFormatter_mx"
                                    data-events="operateEvents_mx">Action
                                </th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="row bg-right">
                <div class="col">
                    <h4 class="title-right">List of printed medical prescriptions</h4>
                    <table id="mxrx_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                        data-search="false" data-query-params="queryParams" data-response-handler="responseHandler_mxrx"
                        data-detail-formatter="detailFormatter_mxrx" data-detail-view="true"
                        data-detail-view-icon="true">
                        <thead>
                            <tr>
                                <th data-field="created_on" data-sortable="true">Created:</th>
                                <th data-field="mx_names" data-sortable="false">Medication</th>
                                <th data-field="operate" data-formatter="operateFormatter_mxrx"
                                    data-events="operateEvents_mxrx">Action
                                </th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div> <!-- end medical action col row-->
        [[ pass ]]
        <div class="col">
            <div class="row">
                <div class="col">
                    <h3 class="title-left">Glass Rx</h3>
                </div>
            </div>
            <div class="row bg-left">
                <div class="col">
                    <button type="button" id="btnGxRx" class="btn btn-warning btn-sm mx-2 float-end">Prescribe glasses<i
                            class="mx-2 fas fa-glasses"></i></button>
                    <table id="GxRx_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                        data-search="false" data-query-params="queryParams" data-response-handler="responseHandler_gx"
                        data-detail-formatter="detailFormatter_gx" data-detail-view="true" data-detail-view-icon="true">
                        <thead>
                            <tr>
                                <th data-field="datestamp" data-sortable="true">Datestamp</th>
                                <th data-field="glass_type" data-sortable="false">Glass type</th>
                                <th data-field="formulaR" data-sortable="true">Rx right</th>
                                <th data-field="formulaL" data-sortable="true">Rx left</th>
                                <th data-field="operate" data-formatter="operateFormatter_gx"
                                    data-events="operateEvents_gx">Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="row bg-left">
                <div class="col">
                    <h4 class="title-left">List of printed lenses prescriptions</h4>
                    <button type="button" id="btnCxRx" class="btn btn-warning btn-sm mx-2 float-end">Prescribe
                        contacts<i class="mx-2 fas fa-bullseye"></i></button>
                    <table id="cxrx_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                        data-search="false" data-query-params="queryParams" data-response-handler="responseHandler_cxrx"
                        data-detail-formatter="detailFormatter_cxrx" data-detail-view="true"
                        data-detail-view-icon="true">
                        <thead>
                            <tr>
                                <th data-field="datestamp" data-sortable="true">Datestamp</th>
                                <th data-field="lensnameR" data-sortable="false">Right lens</th>
                                <th data-field="formulaR" data-sortable="true">Rx right</th>
                                <th data-field="lensnameR" data-sortable="false">Left lens</th>
                                <th data-field="formulaL" data-sortable="true">Rx left</th>
                                <th data-field="operate" data-formatter="operateFormatter_cxrx"
                                    data-events="operateEvents_cxrx">Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div> <!-- end glasses/lenses action col row-->
        <div class="col">
            <div class="row">
                <div class="col">
                    <h3 class="title-right">Papers</h3>
                </div>
            </div>
            <div class="row bg-right">
                <div class="col">
                    <h4 class="title-right">List of printed certificates</h4>
                    <button type="button" id="btnNewcertificate" class="btn btn-info btn-sm" data-bs-toggle="modal"
                        data-bs-target="#certificateModal" data-cert-flag="presence">Presence certificate<i
                            class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnNewcertsickleave" class="btn btn-dark btn-sm" data-bs-toggle="modal"
                        data-bs-target="#sickModal">Sick leave certificate<i class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnNewfreecertificate" class="btn btn-primary btn-sm"
                        data-bs-toggle="modal" data-bs-target="#certificateModal" data-cert-flag="free">Free
                        certificate<i class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnNewdoccertificate" class="btn btn-secondary btn-sm"
                        data-bs-toggle="modal" data-bs-target="#certificateModal" data-cert-flag="doc">MD certificate<i
                            class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnNeworthocertificate" class="btn btn-warning btn-sm"
                        data-bs-toggle="modal" data-bs-target="#certificateModal" data-cert-flag="ortho">Ortho
                        certificate<i class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnNewpreopcertificate" class="btn btn-primary btn-sm"
                        data-bs-toggle="modal" data-bs-target="#certificateModal" data-cert-flag="preop">Preop
                        certificate<i class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnNewpostopcertificate" class="btn btn-secondary btn-sm"
                        data-bs-toggle="modal" data-bs-target="#certificateModal" data-cert-flag="postop">Postop
                        certificate<i class="mx-2 fas fa-plus"></i></button>
                    <button type="button" id="btnNewemailInfo" class="btn btn-info btn-sm" data-bs-toggle="modal"
                        data-bs-target="#emailInfoModal" data-cert-flag="email">Email info<i
                            class="mx-2 fas fa-plus"></i></button>
                    <table id="cert_tbl" data-side-pagination="server" data-pagination="true" data-page-size="5"
                        data-search="false" data-query-params="queryParams" data-response-handler="responseHandler_cert"
                        data-detail-formatter="detailFormatter_cert" data-detail-view="true"
                        data-detail-view-icon="true">
                        <thead>
                            <tr>
                                <th data-field="datestamp" data-sortable="true">Datestamp</th>
                                <th data-field="category" data-sortable="true">Category</th>
                                <th data-field="operate" data-formatter="operateFormatter_cert"
                                    data-events="operateEvents_cert">Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>

    [[ include 'modalityCtr/sections/actions/follow-up.html' ]]

</div>

[[ if userMembership == 'Doctor':]]
<div id="bill-container" class="container-fluid mb-3"> <!-- container billing -->
    <div class="row mb-3 big-title bg-success">
        <div class="col">
            <h2><a role="button" data-bs-toggle="collapse" href=".bill">Billing</a></h2>
        </div>
    </div>
    <div class="row mb-3 bill">
        <div class="col">
            <div class="row">
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <h3 class="title-right">Billing Codes</h3>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="row mb-2">
                                <div class="col">
                                    <button type="button" id="btnNewBillCode" class="btn btn-dark btn-sm me-2"
                                        data-bs-toggle="modal" data-bs-target="#billCodeModal">
                                        Add Code<i class="mx-2 fas fa-plus"></i>
                                    </button>
                                    <button type="button" id="btnApplyCombo" class="btn btn-success btn-sm"
                                        data-bs-toggle="modal" data-bs-target="#billComboModal">
                                        Apply Combo<i class="mx-2 fas fa-layer-group"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="row bg-neutral">
                                <div class="col">
                                    <table id="bill_tbl" data-side-pagination="server" data-pagination="true"
                                        data-page-size="10" data-search="false" data-query-params="queryParams"
                                        data-response-handler="responseHandler_billing"
                                        data-detail-formatter="detailFormatter_billing" data-detail-view="true"
                                        data-detail-view-icon="true">
                                        <thead>
                                            <tr>
                                                <th data-field="date_performed" data-sortable="true">Date</th>
                                                <th data-field="nomen_code" data-sortable="true">Main Code</th>
                                                <th data-field="nomen_desc_fr" data-sortable="false">Main Description
                                                </th>
                                                <th data-field="fee" data-sortable="false">Main Fee</th>
                                                <th data-field="secondary_nomen_code"
                                                    data-formatter="secondaryCodeFormatter" data-sortable="true">
                                                    Secondary Code</th>
                                                <th data-field="secondary_nomen_desc_fr"
                                                    data-formatter="secondaryDescFormatter" data-sortable="false">
                                                    Secondary Description</th>
                                                <th data-field="secondary_fee" data-formatter="secondaryFeeFormatter"
                                                    data-sortable="false">Secondary Fee</th>
                                                <th data-field="total_fee" data-formatter="totalFeeFormatter"
                                                    data-sortable="false">Total Fee</th>
                                                <th data-field="laterality" data-sortable="true">Laterality</th>
                                                <th data-field="quantity" data-sortable="false">Qty</th>
                                                <th data-field="status" data-sortable="true">Status</th>
                                                <th data-field="operate" data-formatter="operateFormatter_billing"
                                                    data-events="operateEvents_billing">Action</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <h3 class="title-left">Billing Summary</h3>
                        </div>
                    </div>
                    <div class="row bg-left">
                        <div class="col">
                            <div id="billingSummary" class="p-3">
                                <!-- Summary content will be dynamically generated by updateBillingSummary() -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>Total Codes: <span id="totalCodes" class="badge bg-primary">0</span></h5>
                                        <h5>Total Amount: <span id="totalAmount" class="badge bg-success">€0.00</span>
                                        </h5>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-outline-primary btn-sm"
                                                onclick="exportBilling('pdf')">
                                                Export PDF<i class="ms-1 fas fa-file-pdf"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-success btn-sm"
                                                onclick="exportBilling('excel')">
                                                Export Excel<i class="ms-1 fas fa-file-excel"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
[[ pass ]]
[[ include 'modalityCtr/modals/history/medication-modal.html' ]]

<!-- Modal axModal -->
<div class="modal fade" id="axModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">New allergy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <form id="axFormModal" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row mb-3">
                                        <div class="col">
                                            <span class="form-label">Type:</s>
                                                <div class="input-group">
                                                    <div class="btn-group typ_modal">
                                                        <input type="radio" id="typ_allergy_modal" name="typ"
                                                            class="btn-check" value="allergy" autocomplete="off">
                                                        <label class="btn btn-outline-primary"
                                                            for="typ_allergy_modal">Allergy</label>
                                                        <input type="radio" id="typ_atopy_modal" name="typ"
                                                            class="btn-check" value="atopy" autocomplete="off">
                                                        <label class="btn btn-outline-primary"
                                                            for="typ_atopy_modal">Atopy</label>
                                                        <input type="radio" id="typ_intolerance_modal" name="typ"
                                                            class="btn-check" value="intolerance" autocomplete="off">
                                                        <label class="btn btn-outline-primary"
                                                            for="typ_intolerance_modal">Intolerance</label>
                                                    </div>
                                                </div>
                                        </div>
                                        <div class="col">
                                            <label for="axOnset" class="form-label">Onset:</label>
                                            <input id="axOnset" type="date" step="1" class="form-control" name="onset">
                                            <div id="axOnsetHelp" class="form-text">Adjust onset</div>
                                        </div>
                                        <div class="col">
                                            <label for="axEnded" class="form-label">End:</label>
                                            <input id="axEnded" type="date" step="1" class="form-control" name="ended">
                                            <div id="axEndedHelp" class="form-text">Adjust end date</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <label for="agentModal" class="form-label">Agent:</label>
                                            <input id="agentModal" type="text" class="form-control" name="agent"
                                                autocomplete="off">
                                            <div id="medicModalHelp" class="form-text">Enter agent name</div>
                                        </div>
                                    </div>
                                </div>
                                <input id="idAgent" type="text" class="visually-hidden" name="id_agent" />
                                <input id="idAxRow" type="text" class="visually-hidden" name="id" />
                                <input id="idPatientAx" type="text" class="visually-hidden" name="id_auth_user" />
                                <input id="methodAxModalSubmit" type="text" class="visually-hidden"
                                    name="methodAxModalSubmit" value="POST" />
                                <input id="btnAxModalSubmit" type="submit" class="visually-hidden" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <label id="axModalSubmit" for="btnAxModalSubmit" class="btn btn-primary" tabindex="0">Submit</label>
            </div>
        </div>
    </div>
</div>

<!-- Modal mHxModal -->
<div class="modal fade" id="mHxModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">New medical history</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <form id="mHxFormModal" enctype="multipart/form-data" method="POST">
                                <div class="container-fluid">
                                    <div class="row mb-3">
                                        <div class="col">
                                            <span class="form-label">Category:</span>
                                            <div class="input-group">
                                                <div class="btn-group category_modal">
                                                    <input type="radio" id="mHxcategory_medical_modal" name="category"
                                                        class="btn-check" value="medical" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="mHxcategory_medical_modal">Medical</label>
                                                    <input type="radio" id="mHxcategory_surgical_modal" name="category"
                                                        class="btn-check" value="surgical" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="mHxcategory_surgical_modal">Surgical</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <span class="form-label">Site:</span>
                                            <div class="input-group">
                                                <div class="btn-group site_modal">
                                                    <input type="radio" id="mHxsite_right_modal" name="site"
                                                        class="btn-check" value="right" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="mHxsite_right_modal">Right</label>
                                                    <input type="radio" id="mHxsite_left_modal" name="site"
                                                        class="btn-check" value="left" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="mHxsite_left_modal">Left</label>
                                                    <input type="radio" id="mHxsite_both_modal" name="site"
                                                        class="btn-check" value="both" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="mHxsite_both_modal">Both</label>
                                                    <input type="radio" id="mHxsite_local_modal" name="site"
                                                        class="btn-check" value="local" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="mHxsite_local_modal">Local</label>
                                                    <input type="radio" id="mHxsite_systemic_modal" name="site"
                                                        class="btn-check" value="systemic" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="mHxsite_systemic_modal">Systemic</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <label for="mHxOnset" class="form-label">Onset:</label>
                                            <input id="mHxOnset" type="date" step="1" class="form-control" name="onset">
                                            <div id="mHxOnsetHelp" class="form-text">Adjust onset</div>
                                        </div>
                                        <div class="col">
                                            <label for="mHxEnded" class="form-label">End:</label>
                                            <input id="mHxEnded" type="date" step="1" class="form-control" name="ended">
                                            <div id="mHxEndedHelp" class="form-text">Adjust end date</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <label for="mHxtitleModal" class="form-label">Title:</label>
                                            <input id="mHxtitleModal" type="text" class="form-control" name="title"
                                                autocomplete="off">
                                            <div id="mHxtitleModalHelp" class="form-text">Enter disease title</div>
                                        </div>
                                        <div class="col">
                                            <label for="mHxnoteModal" class="form-label">Note:</label>
                                            <input id="mHxnoteModal" type="text" class="form-control" name="note"
                                                autocomplete="off">
                                            <div id="mHxnoteModalHelp" class="form-text">Note</div>
                                        </div>
                                    </div>
                                </div>
                                <input id="idDiseaseRef" type="text" class="visually-hidden" name="id_disease_ref" />
                                <input id="idmHxRow" type="text" class="visually-hidden" name="id" />
                                <input id="idmHxWl" type="text" class="visually-hidden" name="id_worklist" />
                                <input id="idPatientmHx" type="text" class="visually-hidden" name="id_auth_user" />
                                <input id="methodmHxModalSubmit" type="text" class="visually-hidden"
                                    name="methodmHxModalSubmit" value="POST" />
                                <input id="btnmHxModalSubmit" type="submit" class="visually-hidden" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <label id="mHxModalSubmit" for="btnmHxModalSubmit" class="btn btn-primary" tabindex="0">Submit</label>
            </div>
        </div>
    </div>
</div>

<!-- Modal mxRxModal -->
<div class="modal fade" id="mxRxModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Prescription module</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="visually-hidden"><canvas id="itf"></canvas></div>
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Medication</th>
                                        <th scope="col">Posology</th>
                                        <th scope="col">Onset</th>
                                        <th scope="col">End</th>
                                    </tr>
                                </thead>
                                <tbody id="mxRxTd">
                                    <!-- insert rows <td></td>-->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" id="mxRxModalPrint" class="btn btn-primary">Print</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal GxRxModal -->
<div class="modal fade" id="GxRxModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Glass module</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="row">
                                <div class="col title-right">
                                    <h4>Rx Right eye</h4>
                                </div>
                            </div>
                            <div class="row bg-right">
                                <div class="col">
                                    <table class="table right">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="GxRxRTd">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="col title-left">
                                    <h4>Rx Left eye</h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col bg-left">
                                    <table class="table left">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="GxRxLTd">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div> <!-- end table row-->
                    <div class="row mt-3">
                        <div class="col">
                            <div class="row">
                                <div class="col title-right">
                                    <h4>Rx Right to prescribe</h4>
                                </div>
                            </div>
                            <div class="row bg-right">
                                <div class="col">
                                    <table class="table right">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="GxRxright">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="col title-left">
                                    <h4>Rx Left eye to prescribe</h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col bg-left">
                                    <table class="table left">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="GxRxleft">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div> <!-- end table row-->
                    <div class="row mb-3">
                        <div class="col">
                            <form id="GxRxFormModal">
                                <div class="container-fluid">
                                    <div class="row mb-3">
                                        <div class="col" id="modalTypeDiv">
                                            <span class="form-label">Glass type:</span>
                                            <div class="input-group">
                                                <div class="btn-group glass_type_modal">
                                                    <input type="radio" id="glass_type_monofar_modal" name="glass_type"
                                                        class="btn-check" value="monofocalfar" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="glass_type_monofar_modal">Monofocal far</label>
                                                    <input type="radio" id="glass_type_monoclose_modal"
                                                        name="glass_type" class="btn-check" value="monofocalclose"
                                                        autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="glass_type_monoclose_modal">Monofocal close</label>
                                                    <input type="radio" id="glass_type_prog_modal" name="glass_type"
                                                        class="btn-check" value="progressive" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="glass_type_prog_modal">Progressive</label>
                                                    <input type="radio" id="glass_type_bif_modal" name="glass_type"
                                                        class="btn-check" value="bifocal" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="glass_type_bif_modal">Bifocal</label>
                                                    <input type="radio" id="glass_type_deg_modal" name="glass_type"
                                                        class="btn-check" value="degressive" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="glass_type_deg_modal">Degressive</label>
                                                    <input type="radio" id="glass_type_na" name="glass_type"
                                                        class="btn-check visually-hidden" value="na" autocomplete="off">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col" id="art30Div">
                                            <span class="form-label">Article 30:</span>
                                            <div class="input-group">
                                                <div class="btn-group art30_modal">
                                                    <input type="radio" id="art30_no_modal" name="art30"
                                                        class="btn-check" value="False" autocomplete="off" checked>
                                                    <label class="btn btn-outline-primary"
                                                        for="art30_no_modal">No</label>
                                                    <input type="radio" id="art30_yes_modal" name="art30"
                                                        class="btn-check" value="True" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="art30_yes_modal">Yes</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <label for="GxHxremarksModal" class="form-label">Remarks:</label>
                                            <input id="GxHxremarksModal" type="text" class="form-control" name="remarks"
                                                autocomplete="off">
                                            <div id="GxHxremarksModalHelp" class="form-text">Enter remarks including
                                                related to prism</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col bg-right">
                                            <div class="row">
                                                <div class="col">
                                                    <label for="GxHxprismRModal" class="form-label">Prism right:</label>
                                                    <input id="GxHxprismRModal" type="number" class="form-control"
                                                        name="prismR" autocomplete="off">
                                                    <div id="GxHprismRModalHelp" class="form-text">Enter prismvalue
                                                        right in diopters</div>
                                                </div>
                                                <div class="col">
                                                    <label for="GxHxbaseRModal" class="form-label">Base right:</label>
                                                    <input id="GxHxbaseRModal" type="text" class="form-control"
                                                        name="baseR" autocomplete="off">
                                                    <div id="GxHbaseRModalHelp" class="form-text">Enter base direction
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col bg-left">
                                            <div class="row">
                                                <div class="col">
                                                    <label for="GxHxprismLModal" class="form-label">Prism left:</label>
                                                    <input id="GxHxprismLModal" type="number" class="form-control"
                                                        name="prismL" autocomplete="off">
                                                    <div id="GxHprismLModalHelp" class="form-text">Enter prismvalue left
                                                        in diopters</div>
                                                </div>
                                                <div class="col">
                                                    <label for="GxHxbaseLModal" class="form-label">Prism left:</label>
                                                    <input id="GxHxbaseLModal" type="text" class="form-control"
                                                        name="baseL" autocomplete="off">
                                                    <div id="GxHbaseLModalHelp" class="form-text">Enter base direction
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col" id="tintDiv">
                                            <span class="form-label">Tint:</span>
                                            <div class="input-group">
                                                <div class="btn-group tint_modal">
                                                    <input type="radio" id="tint_no_modal" name="tint" class="btn-check"
                                                        value="" autocomplete="off" checked>
                                                    <label class="btn btn-outline-primary"
                                                        for="tint_no_modal">No</label>
                                                    <input type="radio" id="tint_notmedical_modal" name="tint"
                                                        class="btn-check" value="False" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="tint_notmedical_modal">Non medical</label>
                                                    <input type="radio" id="tint_medical_modal" name="tint"
                                                        class="btn-check" value="True" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="tint_medical_modal">Medical</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col" id="tintDiv">
                                            <span class="form-label">Photochromic:</span>
                                            <div class="input-group">
                                                <div class="btn-group photo_modal">
                                                    <input type="radio" id="photo_no_modal" name="photo"
                                                        class="btn-check" value="" autocomplete="off" checked>
                                                    <label class="btn btn-outline-primary"
                                                        for="photo_no_modal">No</label>
                                                    <input type="radio" id="photo_notmedical_modal" name="photo"
                                                        class="btn-check" value="False" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="photo_notmedical_modal">Non medical</label>
                                                    <input type="radio" id="photo_medical_modal" name="photo"
                                                        class="btn-check" value="True" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="photo_medical_modal">Medical</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <label for="GxRxemailInput" class="form-label">Email:</label>
                                            <input id="GxRxemailInput" type="email" class="form-control" name="email">
                                            <div id="GxRxemailHelp" class="form-text">Email address for sending
                                                prescription (pre-filled with patient's email)</div>
                                        </div>
                                    </div>
                                </div>
                                <input id="idGxHxWl" type="text" class="visually-hidden" name="id_worklist" />
                                <input id="idPatientGxHx" type="text" class="visually-hidden" name="id_auth_user" />
                                <input id="methodGxHxModalSubmit" type="text" class="visually-hidden"
                                    name="methodGxHxModalSubmit" value="POST" />
                                <!-- TODO: is methodGxHxModalSubmit right ? -->
                                <input id="btnGxRxModalSubmit" type="submit" class="visually-hidden" />
                                <!-- Hidden field to indicate action type -->
                                <input type="hidden" name="actionType" id="GxRxactionType" value="print">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" id="emailGxRxBtn" class="btn btn-info">Send by email</button>
                <label id="GxRxModalSubmit" for="btnGxRxModalSubmit" class="btn btn-primary" tabindex="0">Print</label>
            </div>
        </div>
    </div>
</div>

<!-- Modal CxRxModal -->
<div class="modal fade" id="CxRxModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Contact lenses module</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="row">
                                <div class="col title-right">
                                    <h4>Rx Right eye</h4>
                                </div>
                            </div>
                            <div class="row bg-right">
                                <div class="col">
                                    <table class="table right">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="CxRxRTd">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="col title-left">
                                    <h4>Rx Left eye</h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col bg-left">
                                    <table class="table left">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="CxRxLTd">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div> <!-- end table row-->
                    <div class="row mt-3">
                        <div class="col">
                            <div class="row">
                                <div class="col title-right">
                                    <h4>Rx Right to prescribe</h4>
                                </div>
                            </div>
                            <div class="row bg-right">
                                <div class="col">
                                    <table class="table right">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="CxRxright">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row">
                                <div class="col title-left">
                                    <h4>Rx Left eye to prescribe</h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col bg-left">
                                    <table class="table left">
                                        <thead>
                                            <tr>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Type</th>
                                                <th scope="col">Rx</th>
                                                <th scope="col"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="CxRxleft">
                                            <!-- insert rows <td></td>-->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div> <!-- end table row-->
                    <div class="row mb-3">
                        <div class="col">
                            <form id="CxRxFormModal">
                                <div class="container-fluid">
                                    <div class="row my-2">
                                        <h4 class="big-title bg-neutral">Contact lenses prescription</h4>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col bg-right">
                                            <div class="row">
                                                <h5 class="title-right">Right contact</h5>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" class="form-control"
                                                            id="sphR_lc" placeholder="Sphere" name="sphR">
                                                        <label for="sphR_lc">Sphere</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" class="form-control"
                                                            id="cylR_lc" placeholder="Cylinder" name="cylR">
                                                        <label for="cylR_lc">Cylinder</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" class="form-control"
                                                            id="axisR_lc" placeholder="Axis" name="axisR">
                                                        <label for="axisR_lc">Axis</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" min="0" value="0"
                                                            class="form-control" id="addR_lc" placeholder="Addition"
                                                            name="addcR">
                                                        <label for="addR_lc">Add</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <label for="lensnameRModal" class="form-label">Lens:</label>
                                                    <input id="lensnameRModal" type="text" class="form-control"
                                                        name="lensnameR" autocomplete="off">
                                                    <div id="lensnameRModalHelp" class="form-text">Choose lens</div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.05" class="form-control"
                                                            id="basecurveR_lc" placeholder="Base curve"
                                                            name="basecurveR">
                                                        <label for="basecurveR_lc">Base curve</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.10" class="form-control"
                                                            id="diameterR_lc" placeholder="Diameter" name="diameterR">
                                                        <label for="diameterR_lc">Diameter</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col bg-left">
                                            <div class="row">
                                                <h5 class="title-left">Left contact</h5>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" class="form-control"
                                                            id="sphL_lc" placeholder="Sphere" name="sphL">
                                                        <label for="sphL_lc">Sphere</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" class="form-control"
                                                            id="cylL_lc" placeholder="Cylinder" name="cylL">
                                                        <label for="cylL_lc">Cylinder</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" class="form-control"
                                                            id="axisL_lc" placeholder="Axis" name="axisL">
                                                        <label for="axisL_lc">Axis</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.25" min="0" value="0"
                                                            class="form-control" id="addL_lc" placeholder="Addition"
                                                            name="addcL">
                                                        <label for="addL_lc">Add</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <label for="lensnameLModal" class="form-label">Lens:</label>
                                                    <input id="lensnameLModal" type="text" class="form-control"
                                                        name="lensnameL" autocomplete="off">
                                                    <div id="lensnameLModalHelp" class="form-text">Choose lens</div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.05" class="form-control"
                                                            id="basecurveL_lc" placeholder="Base curve"
                                                            name="basecurveL">
                                                        <label for="basecurveL_lc">Base curve</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-floating mb-3">
                                                        <input type="number" step="0.10" class="form-control"
                                                            id="diameterL_lc" placeholder="Diameter" name="diameterL">
                                                        <label for="diameterL_lc">Diameter</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col bg-right">
                                            <label for="CxRxcleaningRModal" class="form-label">Right cleaning
                                                solution:</label>
                                            <input id="CxRxcleaningRModal" type="text" class="form-control"
                                                name="cleaningR" autocomplete="off">
                                            <div id="CxRxcleaningRModalHelp" class="form-text">Enter cleaning solution
                                            </div>
                                        </div>
                                        <div class="col bg-left">
                                            <label for="CxRxcleaningLModal" class="form-label">Left cleaning
                                                solution:</label>
                                            <input id="CxRxcleaningLModal" type="text" class="form-control"
                                                name="cleaningL" autocomplete="off">
                                            <div id="CxRxcleaningLModalHelp" class="form-text">Enter cleaning solution
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col" id="group-1">
                                            <h6 class="big-title bg-neutral">Group 1 contact lenses</h6>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g1sspheric"
                                                    id="g1sspheric">
                                                <label class="form-check-label" for="g1sspheric">
                                                    Soft spheric contact lenses
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g1storic"
                                                    id="g1storic">
                                                <label class="form-check-label" for="g1storic">
                                                    Soft toric contact lenses
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g1rspheric"
                                                    id="g1rspheric">
                                                <label class="form-check-label" for="g1rspheric">
                                                    Rigid spheric contact lenses
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g1rtoric"
                                                    id="g1rtoric">
                                                <label class="form-check-label" for="g1rtoric">
                                                    Rigid toric contact lenses
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col" id="group-2">
                                            <h6 class="big-title bg-neutral">Group 2 irregular cornea</h6>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g2soft"
                                                    id="g2soft">
                                                <label class="form-check-label" for="g2soft">
                                                    Soft or hybrid
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g2rigidc"
                                                    id="g2rigidc">
                                                <label class="form-check-label" for="g2rigidc">
                                                    Rigid corneal
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g2rigidcs"
                                                    id="g2rigidcs">
                                                <label class="form-check-label" for="g2rigidcs">
                                                    Rigid corneo-scleral
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g2rigids"
                                                    id="g2rigids">
                                                <label class="form-check-label" for="g2rigids">
                                                    Rigid scleral
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col" id="group-3">
                                            <h6 class="big-title bg-neutral">Group 3 special</h6>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g3iris"
                                                    id="g3iris">
                                                <label class="form-check-label" for="g3iris">
                                                    Soft with opaque iris
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="g3pupil"
                                                    id="g3pupil">
                                                <label class="form-check-label" for="g3pupil">
                                                    Soft with opaque pupil
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col" id="art30CDiv">
                                            <span class="form-label">Article 30:</span>
                                            <div class="input-group">
                                                <div class="btn-group art30C_modal">
                                                    <input type="radio" id="art30C_no_modal" name="art30"
                                                        class="btn-check" value="False" autocomplete="off" checked>
                                                    <label class="btn btn-outline-primary"
                                                        for="art30C_no_modal">No</label>
                                                    <input type="radio" id="art30C_yes_modal" name="art30"
                                                        class="btn-check" value="True" autocomplete="off">
                                                    <label class="btn btn-outline-primary"
                                                        for="art30C_yes_modal">Yes</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <label for="CxRxremarksModal" class="form-label">Remarks:</label>
                                            <input id="CxRxremarksModal" type="text" class="form-control" name="remarks"
                                                autocomplete="off">
                                            <div id="CxRxremarksModalHelp" class="form-text">Enter remarks concerning
                                                contact lenses adaptation</div>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col">
                                            <label for="CxRxemailInput" class="form-label">Email:</label>
                                            <input id="CxRxemailInput" type="email" class="form-control" name="email">
                                            <div id="CxRxemailHelp" class="form-text">Email address for sending
                                                prescription (pre-filled with patient's email)</div>
                                        </div>
                                    </div>
                                </div>
                                <input id="CxRxmaterialR" type="text" class="visually-hidden" name="materialR" />
                                <input id="CxRxmaterialL" type="text" class="visually-hidden" name="materialL" />
                                <input id="CxRxdesignR" type="text" class="visually-hidden" name="designR" />
                                <input id="CxRxdesignL" type="text" class="visually-hidden" name="designL" />
                                <input id="CxRxedgeR" type="text" class="visually-hidden" name="edgeR" />
                                <input id="CxRxedgeL" type="text" class="visually-hidden" name="edgeL" />
                                <input id="CxRxopticalzoneR" type="text" class="visually-hidden" name="opticalzoneR" />
                                <input id="CxRxopticalzoneL" type="text" class="visually-hidden" name="opticalzoneL" />
                                <input id="idCxRxWl" type="text" class="visually-hidden" name="id_worklist" />
                                <input id="idPatientCxRx" type="text" class="visually-hidden" name="id_auth_user" />
                                <input id="btnCxRxModalSubmit" type="submit" class="visually-hidden" />
                                <!-- Hidden field to indicate action type -->
                                <input type="hidden" name="actionType" id="CxRxactionType" value="print">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" id="emailCxRxBtn" class="btn btn-info">Send by email</button>
                <label id="CxRxModalSubmit" for="btnCxRxModalSubmit" class="btn btn-primary" tabindex="0">Print</label>
            </div>
        </div>
    </div>
</div>

<!-- Modal certificateModal -->
<div class="modal fade" id="certificateModal" tabindex="-1" aria-labelledby="certificateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="certificateModalLabel">Certificat</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="certificateFormModal">
                <div class="modal-body">
                    <div class="container">
                        <!-- Hidden input for actionType -->
                        <input type="hidden" name="actionType" id="certificateActionType" value="print">
                        <div class="container-fluid">
                            <div class="row mb-3">
                                <div class="col">
                                    <label for="certificateEmailInput" class="form-label">Email:</label>
                                    <input id="certificateEmailInput" type="email" class="form-control" name="email">
                                    <div id="certificateEmailHelp" class="form-text">Email address for sending
                                        certificate (pre-filled with patient's email)</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <textarea name="content" id="certificateContent">
                                    </textarea>
                                </div>
                            </div>
                        </div>
                        <input id="certificateCat" type="text" class="visually-hidden" name="category" />
                        <input id="certificateDest" type="text" class="visually-hidden" name="destination" />
                        <input id="certificateTitle" type="text" class="visually-hidden" name="title" />
                        <input id="certificateOnset" type="text" class="visually-hidden" name="onset" />
                        <input id="certificateEnded" type="text" class="visually-hidden" name="ended" />
                        <input id="idcertificateWl" type="text" class="visually-hidden" name="id_worklist" />
                        <input id="idPatientcertificate" type="text" class="visually-hidden" name="id_auth_user" />
                        <input id="methodcertificateModalSubmit" type="text" class="visually-hidden"
                            name="methodcertificateModalSubmit" value="POST" />
                        <input id="btncertificateModalSubmit" type="submit" class="visually-hidden" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="emailCertificateBtn" class="btn btn-info">Send by email</button>
                    <label id="certificateModalSubmit" for="btncertificateModalSubmit" class="btn btn-primary"
                        tabindex="0">Print</label>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal sickModal -->
<div class="modal fade" id="sickModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sick leave module</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <form id="sickFormModal">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col">
                                    <label for="onsetsick" class="form-label">Onset:</label>
                                    <input id="onsetsick" type="date" step="1" class="form-control" name="onset">
                                    <div id="onsetsickHelp" class="form-text">Sick leave onset</div>
                                </div>
                                <div class="col">
                                    <label for="endedsick" class="form-label">End:</label>
                                    <input id="endedsick" type="date" step="1" class="form-control" name="ended">
                                    <div id="endedsickHelp" class="form-text">Sick leave end</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <span class="form-label">Exit allowance:</span>
                                    <div class="input-group">
                                        <div class="btn-group laterality">
                                            <input type="radio" id="exit_yes" name="exit" class="btn-check" value="yes"
                                                autocomplete="off" checked>
                                            <label class="btn btn-outline-success" for="exit_yes">Yes</label>
                                            <input type="radio" id="exit_no" name="exit" class="btn-check" value="no"
                                                autocomplete="off">
                                            <label class="btn btn-outline-danger" for="exit_no">No</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" data-bs-target="#certificateModal" data-bs-toggle="modal"
                    data-bs-dismiss="modal" data-cert-flag="sick">Edit</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal emailInfoModal -->
<div class="modal fade" id="emailInfoModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId"
    aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Email module</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <form id="emailInfoFormModal">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col">
                                    <textarea name="content" id="emailContent">
                                    </textarea>
                                </div>
                            </div>
                        </div>
                        <input id="emailCat" type="text" class="visually-hidden" name="category" />
                        <input id="emailDest" type="text" class="visually-hidden" name="destination" />
                        <input id="emailTitle" type="text" class="visually-hidden" name="title" />
                        <input id="emailOnset" type="text" class="visually-hidden" name="onset" />
                        <input id="emailEnded" type="text" class="visually-hidden" name="ended" />
                        <input id="idemailWl" type="text" class="visually-hidden" name="id_worklist" />
                        <input id="idPatientemail" type="text" class="visually-hidden" name="id_auth_user" />
                        <input id="methodcemailodalSubmit" type="text" class="visually-hidden"
                            name="methodemailModalSubmit" value="POST" />
                        <input id="btnemailModalSubmit" type="submit" class="visually-hidden" />
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <label id="emailModalSubmit" for="btnemailModalSubmit" class="btn btn-primary" tabindex="0">Send</label>
            </div>
        </div>
    </div>
</div>

<!-- Modal billCodeModal -->
<div class="modal fade" id="billCodeModal" tabindex="-1" role="dialog" aria-labelledby="billCodeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="billCodeModalLabel">Add Billing Code</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <!-- Search Section -->
                    <div class="row mb-3">
                        <div class="col">
                            <h6>Search Nomenclature Codes</h6>
                            <div class="input-group">
                                <input type="text" class="form-control" id="nomenSearchInput"
                                    placeholder="Enter at least 3 characters to search by code or description...">
                                <button class="btn btn-outline-secondary" type="button" id="nomenSearchBtn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <div class="form-text">Start typing to see autocomplete suggestions</div>
                        </div>
                    </div>
                    <!-- Search Results -->
                    <div class="row mb-3" id="nomenSearchResults" style="display: none;">
                        <div class="col">
                            <div class="table-responsive" style="max-height: 300px;">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Description</th>
                                            <th>Fee (€)</th>
                                            <th>Fee Code</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="nomenSearchTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Form Section -->
                    <form id="billCodeForm" enctype="multipart/form-data" method="POST">
                        <!-- Main Nomenclature Code Section -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6 class="text-primary">
                                    <i class="fas fa-star"></i> Main Nomenclature Code *
                                </h6>
                            </div>
                            <div class="col-md-3">
                                <label for="billNomenCode" class="form-label">Code</label>
                                <input type="number" class="form-control" id="billNomenCode" name="nomen_code" required
                                    readonly>
                                <div class="form-text">Primary procedure code</div>
                            </div>
                            <div class="col-md-6">
                                <label for="billNomenDesc" class="form-label">Description</label>
                                <input type="text" class="form-control" id="billNomenDesc" name="nomen_desc_fr"
                                    readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="billFee" class="form-label">Fee (€)</label>
                                <input type="number" class="form-control" id="billFee" name="fee" step="0.01">
                            </div>
                        </div>

                        <!-- Secondary Nomenclature Code Section -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6 class="text-secondary">
                                    <i class="fas fa-plus-circle"></i> Secondary Nomenclature Code (Optional)
                                    <button type="button" class="btn btn-sm btn-outline-danger ms-2"
                                        id="clearSecondaryBtn" style="display: none;">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                </h6>
                            </div>
                            <div class="col-md-3">
                                <label for="billSecondaryNomenCode" class="form-label">Code</label>
                                <input type="number" class="form-control" id="billSecondaryNomenCode"
                                    name="secondary_nomen_code" readonly>
                                <div class="form-text">Additional procedure code</div>
                            </div>
                            <div class="col-md-6">
                                <label for="billSecondaryNomenDesc" class="form-label">Description</label>
                                <input type="text" class="form-control" id="billSecondaryNomenDesc"
                                    name="secondary_nomen_desc_fr" readonly>
                            </div>
                            <div class="col-md-3">
                                <label for="billSecondaryFee" class="form-label">Fee (€)</label>
                                <input type="number" class="form-control" id="billSecondaryFee" name="secondary_fee"
                                    step="0.01">
                            </div>
                        </div>

                        <!-- Total Fee Display -->
                        <div class="row mb-3">
                            <div class="col-md-6 offset-md-6">
                                <div class="card border-success">
                                    <div class="card-body py-2">
                                        <div class="d-flex justify-content-between">
                                            <span>Main Fee:</span>
                                            <span id="mainFeeDisplay">€0.00</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>Secondary Fee:</span>
                                            <span id="secondaryFeeDisplay">€0.00</span>
                                        </div>
                                        <hr class="my-1">
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Total Fee:</span>
                                            <span id="totalFeeDisplay">€0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Common fields -->
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label class="form-label">Laterality</label>
                                <div class="btn-group" role="group">
                                    <input type="radio" class="btn-check" name="laterality" value="both" id="lat_both"
                                        checked>
                                    <label class="btn btn-outline-primary" for="lat_both">Both</label>
                                    <input type="radio" class="btn-check" name="laterality" value="right"
                                        id="lat_right">
                                    <label class="btn btn-outline-primary" for="lat_right">Right</label>
                                    <input type="radio" class="btn-check" name="laterality" value="left" id="lat_left">
                                    <label class="btn btn-outline-primary" for="lat_left">Left</label>
                                    <input type="radio" class="btn-check" name="laterality" value="none" id="lat_none">
                                    <label class="btn btn-outline-primary" for="lat_none">None</label>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="billQuantity" class="form-label">Quantity</label>
                                <input type="number" class="form-control" id="billQuantity" name="quantity" value="1"
                                    min="1">
                            </div>
                            <div class="col-md-3">
                                <label for="billDatePerformed" class="form-label">Date Performed</label>
                                <input type="date" class="form-control" id="billDatePerformed" name="date_performed"
                                    readonly>
                                <div class="form-text">Automatically set from worklist date</div>
                            </div>
                            <div class="col-md-4">
                                <label for="billStatus" class="form-label">Status</label>
                                <select class="form-select" id="billStatus" name="status">
                                    <option value="draft" selected>Draft</option>
                                    <option value="validated">Validated</option>
                                    <option value="billed">Billed</option>
                                    <option value="paid">Paid</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="billNote" class="form-label">Note</label>
                                <textarea class="form-control" id="billNote" name="note" rows="2"
                                    placeholder="Optional note..."></textarea>
                            </div>
                        </div>
                        <!-- Hidden fields -->
                        <input type="hidden" name="id" id="billCodeId">
                        <input type="hidden" name="id_auth_user" id="billUserId" value="[[=patientId]]">
                        <input type="hidden" name="id_worklist" id="billWorklistId" value="[[=wlId]]">
                        <input type="hidden" name="methodBillCodeSubmit" id="methodBillCodeSubmit" value="POST">
                        <!-- Hidden secondary fields for feecode -->
                        <input type="hidden" name="secondary_feecode" id="billSecondaryFeeCode">
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" form="billCodeForm" class="btn btn-primary" id="billCodeSubmit">Add Code</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal billComboModal -->
<div class="modal fade" id="billComboModal" tabindex="-1" role="dialog" aria-labelledby="billComboModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="billComboModalLabel">Apply Billing Combo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row mb-3">
                        <div class="col">
                            <h6>Available Combos</h6>
                            <div class="table-responsive" style="max-height: 400px;">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Specialty</th>
                                            <th>Codes</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comboTableBody">
                                        <!-- Combos will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3" id="comboPreview" style="display: none;">
                        <div class="col">
                            <h6>Combo Preview</h6>
                            <div class="alert alert-info">
                                <h6 id="comboPreviewTitle"></h6>
                                <p id="comboPreviewDesc"></p>
                                <div id="comboPreviewCodes"></div>
                            </div>
                        </div>
                    </div>
                    <form id="comboApplyForm">
                        <div class="row mb-3">
                            <div class="col">
                                <label for="comboNote" class="form-label">Application Note</label>
                                <textarea class="form-control" id="comboNote" name="note" rows="2"
                                    placeholder="Optional note for this combo application"></textarea>
                            </div>
                        </div>
                        <input type="hidden" name="id_combo" id="selectedComboId">
                        <input type="hidden" name="id_auth_user" value="[[=patientId]]">
                        <input type="hidden" name="id_worklist" value="[[=wlId]]">
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="applyComboBtn" disabled>Apply Combo</button>
            </div>
        </div>
    </div>
</div>

[[ include 'modalityCtr/modals/utility/cache-offcanvas.html' ]]

<!-- All Modal Components (extracted for maintainability) -->
<!-- History Modals -->
[[ include 'modalityCtr/modals/history/allergy-modal.html' ]]
[[ include 'modalityCtr/modals/history/medical-history-modal.html' ]]

<!-- Prescription Modals -->
[[ include 'modalityCtr/modals/prescriptions/medical-rx-modal.html' ]]

<!-- Certificate Modals -->
[[ include 'modalityCtr/modals/certificates/certificate-modal.html' ]]
[[ include 'modalityCtr/modals/certificates/sick-leave-modal.html' ]]
[[ include 'modalityCtr/modals/certificates/email-info-modal.html' ]]

[[ block js_scripts]]

<!-- 1. Global Variables - MUST load first -->
[[ include 'modalityCtr/js-sections/md-globals.html' ]]

<!-- 2. External Libraries - Load after globals -->
<script src="js/bootstrap-table_1.22/bootstrap-table.min.js"></script>
<script src="js/bootbox/bootbox.all.min.js"></script>
<script src="js/jquery.serialize-object.min.js"></script>
<!-- https://bootstrap-autocomplete.readthedocs.io/en/latest/ -->
<script src="js/bootstrap-autocomplete.min.js"></script>
<script src="js/timer.jquery.min.js"></script>
<script src="js/useful.js"></script>
<script src="js/patient-bar.js"></script>
<script src="js/md_bt.js"></script>
<!-- pdfmake and template prescription -->
<script src="js/pdfmake/pdfmake.min.js"></script>
<script src="js/pdfmake/vfs_fonts.js"></script>
<script src="js/jsbarcode/JsBarcode.itf.min.js"></script>
<script src="js/html-to-pdfmake.js"></script>
<!-- tinymce -->
<script src="js/tinymce/tinymce.min.js"></script>

<!-- 3. API Endpoints - Depends on globals -->
[[ include 'modalityCtr/js-sections/md-apis.html' ]]

<!-- 4. Bootstrap Tables - Depends on APIs and external libraries -->
[[ include 'modalityCtr/js-sections/md-tables.html' ]]

<!-- 5. Initialization - Depends on all previous sections -->
[[ include 'modalityCtr/js-sections/md-init.html' ]]

<!-- 6. Medical Examination Logic - Load after all bootstrap tables -->
<script src="js/md.js"></script>
<script src="js/prescription.js"></script>
<script src="js/glasses.js"></script>
<script src="js/contacts.js"></script>
<script src="js/certificates.js"></script>
[[ end ]]