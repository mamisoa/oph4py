[[extend 'baseof.html']]
[[ block left_nav ]]
<li class="nav-item">
    <a href="[[=URL('user')]]" class="nav-link">Users</a>
</li>
[[ end]]

<div class="container">
    <button class="btn btn-warning mx-2" id="getList" type="button">Get list</button>
</div>

<div class="container">
    <form id="searchForm">
        <div class="form-group">
          <label for="searchText">Search</label>
          <input type="text" name="searchStr" class="form-control" id="searchText" aria-describedby="search" placeholder="Lastname,firstname">
          <small id="searchHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>

<div id="list" class="container">
</div>

<div>
    <p>User is: [[= XML(globals().get('user',{})) ]]</p>
</div>

[[ block js_scripts]]
<script src="js/jquery.serialize-object.min.js"></script>
<script type="text/javascript">
const HOSTURL = "[[ = hosturl ]]";

$('#getList').click(function(){
    $.ajax({
        url: HOSTURL + "/myapp/rest/l80",
        contentType: 'application/json',
        dataType: 'json',
        method: 'GET'
    })
    .done(function(data){
        html = [];
        console.log(data);
        html.push('<ul class="list-group">');
        for (let e in data) {
            html.push('<li class="list-group-item">');
            html.push('File name: '+ data[e]["file"] + ' - Path: '+ data[e]["path"]);
            html.push('</li>');
        };
        html.push('</ul>');
        html=html.join('');
        document.getElementById('list').innerHTML += html;
    });
});

$('#searchForm').submit(function(e) {
    e.preventDefault();
    let dataStr = $(this).serializeJSON();
    console.log('dataStr:',dataStr);
    let dataObj = JSON.parse(dataStr);
    console.log('dataObj:',dataObj);
    let searchList = dataObj['searchStr'].split(',');
    if (searchList[0] == undefined)
        { searchList[0] = ''};
    if (searchList[1] == undefined)
        { searchList[1] = ''};
    console.log('searchList:',searchList);
    // let reg = new RegExp(searchList[0]+'\\w*'+'#'+searchList[1]+'\\w*'+"#",'i');
    let searchFile = searchList.join('#')+'#';
    console.log('searchFile:',searchFile);
    $.ajax({
        url: HOSTURL + "/myapp/rest/l80s?lastname="+searchList[0]+"&firstname="+searchList[1],
        contentType: 'application/json',
        dataType: 'json',
        method: 'GET'
    })
    .done(function(data){
        document.getElementById('list').innerHTML = "";
        html = [];
        console.log(data);
        for (let e of data) {
            console.log(e['file']);
            for ( let exam in e['exams'] ) {
                // console.log(e['exams'][exam]);
                for ( let i in e['exams'][exam]) {
                    // console.log(e['exams'][exam][i]);
                    for ( mes of e['exams'][exam][i]) {
                        // console.log(mes);
                        for ( b in mes) {
                            // console.log(b);
                            for ( a of mes[b]) {
                                // console.log(a);
                                for (z of a) {
                                    console.log(z['sph3_left']);
                                }
                            }
                        }
                    }
                }
            };
        };
        // html=html.join('');
        // document.getElementById('list').innerHTML += html;
    });
});

</script>

[[ end ]]